"use strict";function start(a){pc=new RTCPeerConnection(configuration),pc.onicecandidate=function(a){socket.emit("message",{type:"candidate",data:a.candidate})},pc.onaddstream=function(a){portalAnimation.comunication(!0),remoteVideo.src=window.URL.createObjectURL(a.stream)},pc.oniceconnectionstatechange=function(){"disconnected"===pc.iceConnectionState&&console.log("Me cambiaron el estado")},navigator.getUserMedia({audio:!0,video:!0},function(b){function c(a){pc.setLocalDescription(a),socket.emit("message",{type:"description",data:a})}localVideo.src=window.URL.createObjectURL(b),pc.addStream(b),window.stream=b,a?pc.createOffer(c,logFail):pc.createAnswer(c,logFail)},logFail)}function switcher(){window.stream&&(tracks=window.stream.getTracks(),video=tracks[0],audio=tracks[1],video.enabled&&audio.enabled?socket.emit("quiet"):socket.emit("talk"),tracks.forEach(function(a){a.enabled=!a.enabled}))}function logFail(a){console.log(a)}var portalAnimation=new PortalAnimation,io,socket=io.connect(),pc,configuration=null,localVideo=document.getElementById("localvideo"),remoteVideo=document.getElementById("remotevideo"),flag=!1,tracks,video,audio,audioOn=document.getElementById("portalOn"),audioOff=document.getElementById("portalOff"),room=$("#roomid").data("room");socket.on("connect",function(){socket.emit("room",room)}),socket.on("join",function(a){1===a&&(flag=!0,portalAnimation.comunication(!1)),flag===!1&&(portalAnimation.comunication(!0),start(!0))}),socket.on("talk",function(a){audioOn.play(),video.enabled=!0,audio.enabled=!0,portalAnimation.comunication(!0)}),socket.on("quiet",function(a){tracks=window.stream.getTracks(),video=tracks[0],audio=tracks[1],audioOff.play(),video.enabled=!1,audio.enabled=!1,portalAnimation.comunication(!1)}),socket.on("message",function(a){if(pc||start(!1),"description"===a.type)pc.setRemoteDescription(new RTCSessionDescription(a.data));else if("candidate"===a.type&&a.data){var b=new RTCIceCandidate(a.data);pc.addIceCandidate(b,function(a){},logFail)}}),socket.on("redirect",function(){window.location.href="/full"}),socket.on("refresh",function(){window.location.reload()}),$(window).keyup(function(a){82===a.keyCode&&switcher()}),$(document).ready(function(){function a(){$(".remote").height($(window).height())}a(),$(window).resize(function(){a()}),$("#hide-local-preview").click(function(){$(".r-b-corner").toggleClass("hidden")})});